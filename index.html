<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Editor Emmet con Pestañas</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    #tab-bar {
      display: flex;
      background: #222;
      color: white;
      padding: 5px;
      align-items: center;
    }
    .tab {
      background: #444;
      padding: 5px 10px;
      margin-right: 5px;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
    }
    .tab.active {
      background: #666;
    }
    .tab input {
      background: transparent;
      border: none;
      color: white;
      width: 80px;
    }
    .tab .close {
      margin-left: 5px;
      cursor: pointer;
    }
    #add-tab {
      background: #28a745;
      border: none;
      padding: 5px 10px;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    #editor {
      flex: 1;
      display: flex;
      overflow: hidden;
    }
    #monaco {
      width: 50%;
      height: 100%;
    }
    #preview {
      width: 50%;
      height: 100%;
      border: none;
    }
  </style>
</head>
<body>
  <div id="tab-bar">
    <button id="add-tab">+ Nueva Pestaña</button>
  </div>
  <div id="editor">
    <div id="monaco"></div>
    <iframe id="preview"></iframe>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
  <script>
    let tabs = [];
    let currentTab = null;

    require.config({ paths: { vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs" } });
    require(["vs/editor/editor.main"], function () {
      window.createEditor = function (value = "") {
        return monaco.editor.create(document.getElementById("monaco"), {
          value,
          language: "html",
          theme: "vs-dark",
          automaticLayout: true,
        });
      };

      function createTab(name = "Proyecto") {
        const id = "tab" + Date.now();
        const data = {
          id,
          name,
          html: "",
          css: "",
          js: "",
          editor: null
        };
        tabs.push(data);
        renderTabs();
        switchTab(id);
      }

function renderTabs() {
  const tabBar = document.getElementById("tab-bar");
  tabBar.innerHTML = "";
  tabs.forEach((tab) => {
    const el = document.createElement("div");
    el.className = "tab" + (tab.id === currentTab ? " active" : "");

    const input = document.createElement("input");
    input.value = tab.name;
    input.oninput = () => {
      tab.name = input.value;
    };
    input.onclick = (e) => e.stopPropagation();
    el.appendChild(input);

    const close = document.createElement("span");
    close.className = "close";
    close.textContent = "✕";
    close.onclick = (e) => {
      e.stopPropagation();
      tabs = tabs.filter((t) => t.id !== tab.id);
      if (currentTab === tab.id && tabs.length > 0) {
        switchTab(tabs[0].id);
      } else if (tabs.length === 0) {
        currentTab = null;
        editor.dispose();
      }
      renderTabs();
    };

    el.onclick = () => switchTab(tab.id);
    el.appendChild(close);
    tabBar.appendChild(el);
  });

  const addBtn = document.createElement("button");
  addBtn.id = "add-tab";
  addBtn.textContent = "+ Nueva Pestaña";
  addBtn.onclick = () => createTab();
  tabBar.appendChild(addBtn);
}

      let editor;
      function switchTab(id) {
        const tab = tabs.find((t) => t.id === id);
        if (!tab) return;
        if (editor) {
          const model = editor.getModel();
          const code = model.getValue();
          if (model.getLanguageId() === "html") tab.html = code;
          if (model.getLanguageId() === "css") tab.css = code;
          if (model.getLanguageId() === "javascript") tab.js = code;
          editor.dispose();
        }

        currentTab = id;
        renderTabs();

        const htmlModel = monaco.editor.createModel(tab.html, "html");
        editor = monaco.editor.create(document.getElementById("monaco"), {
          model: htmlModel,
          theme: "vs-dark",
        });

        // Emmet Tab support
        editor.addCommand(monaco.KeyCode.Tab, () => {
          if (editor.getModel().getLanguageId() === "html" ||
              editor.getModel().getLanguageId() === "css" ||
              editor.getModel().getLanguageId() === "javascript") {
            window.emmetMonaco.emmetHTML.expandAbbreviation(editor);
          }
        });

        editor.onDidChangeModelContent(() => updatePreview());
        updatePreview();
      }

      function updatePreview() {
        const tab = tabs.find((t) => t.id === currentTab);
        if (!tab || !editor) return;
        const code = editor.getValue();
        const lang = editor.getModel().getLanguageId();
        if (lang === "html") tab.html = code;
        if (lang === "css") tab.css = code;
        if (lang === "javascript") tab.js = code;
        const output = `
          <!DOCTYPE html>
          <html lang="en">
          <head>
            <style>${tab.css}</style>
          </head>
          <body>
            ${tab.html}
            <script>${tab.js}<\/script>
          </body>
          </html>
        `;
        const iframe = document.getElementById("preview");
        iframe.srcdoc = output;
      }

      createTab("Proyecto 1");
    });

    // Emmet Monaco Load
    const script = document.createElement("script");
    script.src = "https://unpkg.com/@emmetio/monaco-plugin/dist/emmet-monaco.min.js";
    script.onload = () => {
      window.emmetMonaco.emmetHTML(monaco);
    };
    document.head.appendChild(script);
  </script>
</body>
</html>
